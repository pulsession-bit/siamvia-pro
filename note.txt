Cahier des charges global — Moteur de blog SiamVisaPro (V1→V3)
1) Objectif produit

Publier des articles multilingues (FR/EN/TH), SEO-first, avec maillage interne automatique, et édition assistée IA (génération/structuration/traduction) sous contraintes.

Garantir : vitesse, cohérence, auditabilité, absence de bruit.

2) Périmètre V1

Blog + catégories + tags + auteurs

Articles en blocs (intro/sections/table/FAQ/CTA)

Multilangue natif (hreflang, canonical, fallback)

Maillage interne assisté (règles + scoring)

Images SEO (WebP/AVIF, alt, filename, LCP)

Publication (draft → review → publish) + preview

Sitemap, robots, JSON-LD (Article/FAQ/Breadcrumb/Organization)

Logs d’indexation + 404/410 + redirects

3) Non-objectifs V1

Marketplace, commentaires, forum

Traduction “parfaite” automatique sans relecture

Génération de faits non sourcés

4) Rôles & permissions

Admin: configuration globale, taxonomies, règles SEO, règles maillage

Editor: création/édition, validation, publication

Author: rédaction, soumission

Viewer: lecture publique

RBAC + audit trail (qui a modifié quoi, quand)

5) Modèle de données canonique

Article (langue-agnostique) : id, status, canonical_locale, clusters, entities, intent, stage, sources, timestamps

ArticleLocale : locale, seo{title,desc,slug}, blocks[], internal_links_plan, og, schema overrides

Media : variants, width/height, mime, hash, focal point, alt par locale

Redirects : from → to, type (301/308), locale scope

Taxonomy : clusters (piliers), catégories, tags, glossaire

6) Format “Blocks” (contrat)

Types minimum :

intro, section(h2,h3,content), table(data), faq(items), cta, callout, toc, image(ref,caption)
Règles :

1 idée / bloc, paragraphs courts, headings stricts, pas de duplication.

7) Workflow éditorial

Create Draft (Article + ArticleLocale canonical)

IA optionnelle : outline → blocs → FAQ → table → titres SEO

Review (humain) + checklist automatique (structure/SEO/liens)

Localisation : génération ArticleLocale (EN/TH) “structure-preserving”

Preview (URLs stables)

Publish (atomic) + invalidation cache + sitemap ping

Post-publish : monitoring indexation + corrections + versioning

8) IA : fonctions autorisées (contrôlées)

Outline/structuration (à partir du sujet + sources)

Réécriture (clarification, compression, neutralité)

Localisation (traduction + SEO title/desc adaptés)

InternalLinkPlan (propositions + raisons)
Interdits :

inventer des règles/dates/prix ; si source absente → “inconnu” + TODO.

9) Maillage interne (dans le moteur)

Taxonomie canonique : cluster, stage (discover/compare/apply), intent

Règles par article :

2 liens cluster

1 lien “next step”

1 lien glossaire

quota max : 6 liens / 1000 mots

ancres non répétées, diversité contextuelle

Score candidat : 0.45 cluster + 0.35 stage_next + 0.15 popular + 0.05 freshness

Résolution multilangue : lien par to_article_id, slug résolu dans la langue courante, fallback si manquant.

10) SEO technique (exigences)

SSR/SSG (HTML indexable), hydration minimale

hreflang complet + x-default si stratégie choisie

canonical par langue, pas de chaînes de redirect

sitemap.xml index + sitemaps par type/langue

JSON-LD : Article + FAQ + Breadcrumb + Organization

OpenGraph/Twitter Cards

404 propres + 410 pour suppressions (option)

Pagination SEO (blog listing), canonical page 1, noindex si besoin

11) Images & performance

Pipeline image : upload → variants (webp/avif) → cache CDN → headers immuables

LCP : hero optimisé (preload, sizes, width/height)

Cache-control : immutable pour assets, revalidate pour HTML

Objectifs perf : CWV “green” (LCP/INP/CLS)

12) Observabilité & analytics

GA4 + events : view_article, click_internal_link, scroll_depth, faq_expand

Search Console : couverture, erreurs, perfs par locale

Logs applicatifs : publish, invalidate, image transform, errors

Dashboard “content health” : indexation, 404, orphan pages, thin content

13) Sécurité & conformité

Admin routes protégées, CSRF, rate-limit

Validation stricte inputs (blocks JSON)

Stockage médias sécurisé, signature URLs si privé

Audit trail immutable (minimum : qui/quand/quoi)

14) Backups & rollback

Export quotidien (DB + config) + snapshots

Versioning d’article : draft revisions + rollback publish

Redirection manager pour changements de slug

15) Livrables

SCHEMA.json (Article/ArticleLocale/Media/InternalLinkPlan)

Spéc API (CRUD + publish + preview + media)

Règles SEO & maillage (config)

Checklist QA (pré-publish)

Plan de tests (unit + e2e + SEO crawl)

Si tu veux, je peux maintenant générer SCHEMA.json V1 complet + les endpoints (REST) en 1 seul bloc prêt à coder.

oui
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.siamvisapro.com/blog/SCHEMA.v1.json",
  "title": "SiamVisaPro Blog Engine Schema v1",
  "type": "object",
  "properties": {
    "Article": { "$ref": "#/$defs/Article" },
    "ArticleLocale": { "$ref": "#/$defs/ArticleLocale" },
    "Media": { "$ref": "#/$defs/Media" },
    "Redirect": { "$ref": "#/$defs/Redirect" },
    "Taxonomy": { "$ref": "#/$defs/Taxonomy" },
    "InternalLinkPlan": { "$ref": "#/$defs/InternalLinkPlan" },
    "PublishResult": { "$ref": "#/$defs/PublishResult" }
  },
  "required": ["Article", "ArticleLocale", "Media", "Redirect", "Taxonomy", "InternalLinkPlan", "PublishResult"],
  "$defs": {
    "ID": {
      "type": "string",
      "minLength": 4,
      "maxLength": 128,
      "pattern": "^[a-zA-Z0-9._:-]+$"
    },
    "ISODateTime": { "type": "string", "format": "date-time" },
    "Locale": { "type": "string", "pattern": "^[a-z]{2}(-[A-Z]{2})?$" },
    "Status": { "type": "string", "enum": ["draft", "in_review", "scheduled", "published", "archived"] },
    "Stage": { "type": "string", "enum": ["discover", "compare", "apply"] },
    "Intent": { "type": "string", "enum": ["informational", "comparative", "transactional"] },
    "VisaScope": {
      "type": "array",
      "items": { "type": "string", "enum": ["TR", "DTV", "LTR", "NON_B", "NON_O", "ELITE", "ED", "OTHER"] },
      "minItems": 0,
      "uniqueItems": true
    },
    "Slug": {
      "type": "string",
      "minLength": 3,
      "maxLength": 160,
      "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$"
    },
    "URL": { "type": "string", "format": "uri" },

    "Article": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/$defs/ID" },
        "status": { "$ref": "#/$defs/Status" },
        "canonical_locale": { "$ref": "#/$defs/Locale" },

        "topic": { "type": "string", "minLength": 3, "maxLength": 200 },
        "summary": { "type": "string", "maxLength": 500 },

        "clusters": { "type": "array", "items": { "$ref": "#/$defs/ID" }, "uniqueItems": true },
        "categories": { "type": "array", "items": { "$ref": "#/$defs/ID" }, "uniqueItems": true },
        "tags": { "type": "array", "items": { "$ref": "#/$defs/ID" }, "uniqueItems": true },

        "entities": { "type": "array", "items": { "type": "string", "maxLength": 80 }, "uniqueItems": true },
        "visa_scope": { "$ref": "#/$defs/VisaScope" },

        "intent": { "$ref": "#/$defs/Intent" },
        "stage": { "$ref": "#/$defs/Stage" },

        "author_id": { "$ref": "#/$defs/ID" },

        "sources": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "name": { "type": "string", "minLength": 2, "maxLength": 80 },
              "url": { "$ref": "#/$defs/URL" },
              "type": { "type": "string", "enum": ["official", "internal", "news", "other"] },
              "retrieved_at": { "$ref": "#/$defs/ISODateTime" }
            },
            "required": ["name", "type"]
          }
        },

        "featured_media_id": { "$ref": "#/$defs/ID" },

        "published_at": { "anyOf": [{ "$ref": "#/$defs/ISODateTime" }, { "type": "null" }] },
        "created_at": { "$ref": "#/$defs/ISODateTime" },
        "updated_at": { "$ref": "#/$defs/ISODateTime" },

        "version": { "type": "integer", "minimum": 1 },
        "revision_of": { "anyOf": [{ "$ref": "#/$defs/ID" }, { "type": "null" }] }
      },
      "required": ["id", "status", "canonical_locale", "topic", "intent", "stage", "author_id", "created_at", "updated_at", "version"]
    },

    "ArticleLocale": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "article_id": { "$ref": "#/$defs/ID" },
        "locale": { "$ref": "#/$defs/Locale" },

        "seo": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "title": { "type": "string", "minLength": 10, "maxLength": 70 },
            "description": { "type": "string", "minLength": 50, "maxLength": 160 },
            "slug": { "$ref": "#/$defs/Slug" },
            "canonical_url": { "$ref": "#/$defs/URL" },
            "hreflang": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": { "locale": { "$ref": "#/$defs/Locale" }, "url": { "$ref": "#/$defs/URL" } },
                "required": ["locale", "url"]
              }
            },
            "robots": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "index": { "type": "boolean", "default": true },
                "follow": { "type": "boolean", "default": true }
              },
              "required": ["index", "follow"]
            }
          },
          "required": ["title", "description", "slug"]
        },

        "og": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "og_title": { "type": "string", "maxLength": 90 },
            "og_description": { "type": "string", "maxLength": 200 },
            "og_image_media_id": { "$ref": "#/$defs/ID" }
          }
        },

        "toc": { "type": "array", "items": { "$ref": "#/$defs/TOCItem" } },

        "blocks": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Block" }
        },

        "internal_links_plan": { "$ref": "#/$defs/InternalLinkPlan" },

        "schema_overrides": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "faq_enabled": { "type": "boolean", "default": true },
            "breadcrumbs_enabled": { "type": "boolean", "default": true }
          }
        },

        "quality": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "word_count": { "type": "integer", "minimum": 0 },
            "reading_time_min": { "type": "integer", "minimum": 0 },
            "thin_content_flag": { "type": "boolean" },
            "fact_gaps": { "type": "array", "items": { "type": "string", "maxLength": 200 } }
          },
          "required": ["word_count", "reading_time_min", "thin_content_flag", "fact_gaps"]
        },

        "created_at": { "$ref": "#/$defs/ISODateTime" },
        "updated_at": { "$ref": "#/$defs/ISODateTime" }
      },
      "required": ["article_id", "locale", "seo", "blocks", "quality", "created_at", "updated_at"]
    },

    "TOCItem": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "block_id": { "$ref": "#/$defs/ID" },
        "level": { "type": "integer", "enum": [2, 3] },
        "title": { "type": "string", "minLength": 2, "maxLength": 120 },
        "anchor": { "$ref": "#/$defs/Slug" }
      },
      "required": ["block_id", "level", "title", "anchor"]
    },

    "Block": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/$defs/ID" },
        "type": {
          "type": "string",
          "enum": ["toc", "intro", "section", "table", "faq", "cta", "callout", "image", "glossary_ref"]
        },
        "data": { "type": "object" }
      },
      "required": ["id", "type", "data"],
      "allOf": [
        {
          "if": { "properties": { "type": { "const": "intro" } } },
          "then": { "properties": { "data": { "$ref": "#/$defs/BlockIntro" } } }
        },
        {
          "if": { "properties": { "type": { "const": "section" } } },
          "then": { "properties": { "data": { "$ref": "#/$defs/BlockSection" } } }
        },
        {
          "if": { "properties": { "type": { "const": "table" } } },
          "then": { "properties": { "data": { "$ref": "#/$defs/BlockTable" } } }
        },
        {
          "if": { "properties": { "type": { "const": "faq" } } },
          "then": { "properties": { "data": { "$ref": "#/$defs/BlockFAQ" } } }
        },
        {
          "if": { "properties": { "type": { "const": "cta" } } },
          "then": { "properties": { "data": { "$ref": "#/$defs/BlockCTA" } } }
        },
        {
          "if": { "properties": { "type": { "const": "callout" } } },
          "then": { "properties": { "data": { "$ref": "#/$defs/BlockCallout" } } }
        },
        {
          "if": { "properties": { "type": { "const": "image" } } },
          "then": { "properties": { "data": { "$ref": "#/$defs/BlockImage" } } }
        }
      ]
    },

    "BlockIntro": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "content_md": { "type": "string", "minLength": 20, "maxLength": 1200 }
      },
      "required": ["content_md"]
    },

    "BlockSection": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "h2": { "type": "string", "minLength": 2, "maxLength": 120 },
        "h3": { "type": "string", "maxLength": 120 },
        "content_md": { "type": "string", "minLength": 20, "maxLength": 20000 },
        "anchor": { "$ref": "#/$defs/Slug" }
      },
      "required": ["h2", "content_md", "anchor"]
    },

    "BlockTable": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "caption": { "type": "string", "maxLength": 160 },
        "columns": { "type": "array", "items": { "type": "string", "maxLength": 60 }, "minItems": 2 },
        "rows": {
          "type": "array",
          "items": { "type": "array", "items": { "type": "string", "maxLength": 200 }, "minItems": 2 }
        }
      },
      "required": ["columns", "rows"]
    },

    "BlockFAQ": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "items": {
          "type": "array",
          "minItems": 2,
          "maxItems": 8,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "q": { "type": "string", "minLength": 8, "maxLength": 140 },
              "a_md": { "type": "string", "minLength": 20, "maxLength": 1200 }
            },
            "required": ["q", "a_md"]
          }
        }
      },
      "required": ["items"]
    },

    "BlockCTA": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "label": { "type": "string", "minLength": 2, "maxLength": 60 },
        "href": { "$ref": "#/$defs/URL" },
        "variant": { "type": "string", "enum": ["primary", "secondary", "link"], "default": "primary" }
      },
      "required": ["label", "href"]
    },

    "BlockCallout": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "tone": { "type": "string", "enum": ["info", "warning", "note"] },
        "title": { "type": "string", "maxLength": 80 },
        "content_md": { "type": "string", "minLength": 10, "maxLength": 2000 }
      },
      "required": ["tone", "content_md"]
    },

    "BlockImage": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "media_id": { "$ref": "#/$defs/ID" },
        "alt": { "type": "string", "minLength": 5, "maxLength": 140 },
        "caption": { "type": "string", "maxLength": 200 },
        "placement": { "type": "string", "enum": ["inline", "hero"], "default": "inline" }
      },
      "required": ["media_id", "alt"]
    },

    "InternalLinkPlan": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "generated_at": { "$ref": "#/$defs/ISODateTime" },
        "ruleset_version": { "type": "string", "minLength": 1, "maxLength": 20, "default": "v1" },
        "out": {
          "type": "array",
          "maxItems": 16,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "to_article_id": { "$ref": "#/$defs/ID" },
              "anchor": { "type": "string", "minLength": 3, "maxLength": 90 },
              "context_block_id": { "$ref": "#/$defs/ID" },
              "reason": { "type": "string", "enum": ["cluster", "next_step", "definition", "supporting", "related"] },
              "score": { "type": "number", "minimum": 0, "maximum": 1 }
            },
            "required": ["to_article_id", "anchor", "reason", "score"]
          }
        },
        "constraints": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "max_links_per_1000w": { "type": "integer", "minimum": 1, "maximum": 12, "default": 6 },
            "require_next_step": { "type": "boolean", "default": true },
            "require_glossary": { "type": "boolean", "default": true },
            "avoid_duplicate_anchors": { "type": "boolean", "default": true }
          },
          "required": ["max_links_per_1000w", "require_next_step", "require_glossary", "avoid_duplicate_anchors"]
        }
      },
      "required": ["generated_at", "ruleset_version", "out", "constraints"]
    },

    "Media": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/$defs/ID" },
        "origin_url": { "$ref": "#/$defs/URL" },
        "mime": { "type": "string", "enum": ["image/webp", "image/avif", "image/jpeg", "image/png"] },
        "width": { "type": "integer", "minimum": 1 },
        "height": { "type": "integer", "minimum": 1 },
        "hash": { "type": "string", "minLength": 16, "maxLength": 128 },
        "variants": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "url": { "$ref": "#/$defs/URL" },
              "mime": { "type": "string" },
              "width": { "type": "integer" },
              "height": { "type": "integer" }
            },
            "required": ["url", "mime", "width", "height"]
          }
        },
        "alt_by_locale": {
          "type": "object",
          "additionalProperties": { "type": "string", "minLength": 5, "maxLength": 140 }
        },
        "created_at": { "$ref": "#/$defs/ISODateTime" }
      },
      "required": ["id", "origin_url", "mime", "width", "height", "hash", "variants", "created_at"]
    },

    "Redirect": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/$defs/ID" },
        "from": { "type": "string", "minLength": 1, "maxLength": 300 },
        "to": { "type": "string", "minLength": 1, "maxLength": 300 },
        "code": { "type": "integer", "enum": [301, 308] },
        "locale": { "anyOf": [{ "$ref": "#/$defs/Locale" }, { "type": "null" }] },
        "created_at": { "$ref": "#/$defs/ISODateTime" }
      },
      "required": ["id", "from", "to", "code", "created_at"]
    },

    "Taxonomy": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "clusters": { "type": "array", "items": { "$ref": "#/$defs/Taxon" } },
        "categories": { "type": "array", "items": { "$ref": "#/$defs/Taxon" } },
        "tags": { "type": "array", "items": { "$ref": "#/$defs/Taxon" } },
        "glossary": { "type": "array", "items": { "$ref": "#/$defs/GlossaryTerm" } }
      },
      "required": ["clusters", "categories", "tags", "glossary"]
    },

    "Taxon": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/$defs/ID" },
        "label_by_locale": { "type": "object", "additionalProperties": { "type": "string", "maxLength": 80 } },
        "description_by_locale": { "type": "object", "additionalProperties": { "type": "string", "maxLength": 280 } }
      },
      "required": ["id", "label_by_locale"]
    },

    "GlossaryTerm": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/$defs/ID" },
        "term_by_locale": { "type": "object", "additionalProperties": { "type": "string", "maxLength": 80 } },
        "definition_by_locale": { "type": "object", "additionalProperties": { "type": "string", "maxLength": 600 } },
        "see_also_article_ids": { "type": "array", "items": { "$ref": "#/$defs/ID" }, "uniqueItems": true }
      },
      "required": ["id", "term_by_locale", "definition_by_locale"]
    },

    "PublishResult": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "article_id": { "$ref": "#/$defs/ID" },
        "published_locales": { "type": "array", "items": { "$ref": "#/$defs/Locale" }, "uniqueItems": true },
        "invalidated_paths": { "type": "array", "items": { "type": "string" } },
        "sitemaps_touched": { "type": "array", "items": { "type": "string" } },
        "warnings": { "type": "array", "items": { "type": "string", "maxLength": 240 } },
        "published_at": { "$ref": "#/$defs/ISODateTime" }
      },
      "required": ["article_id", "published_locales", "invalidated_paths", "sitemaps_touched", "warnings", "published_at"]
    }
  }
}

openapi: 3.0.3
info:
  title: SiamVisaPro Blog Engine API
  version: "v1"
servers:
  - url: https://api.siamvisapro.com
paths:
  /v1/articles:
    get:
      summary: List articles (filterable)
      parameters:
        - name: status
          in: query
          schema: { type: string, enum: [draft,in_review,scheduled,published,archived] }
        - name: cluster
          in: query
          schema: { type: string }
        - name: tag
          in: query
          schema: { type: string }
        - name: q
          in: query
          schema: { type: string }
        - name: limit
          in: query
          schema: { type: integer, minimum: 1, maximum: 100, default: 20 }
        - name: cursor
          in: query
          schema: { type: string }
      responses:
        "200": { description: OK }
    post:
      summary: Create article (canonical shell)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "SCHEMA.v1.json#/$defs/Article" }
      responses:
        "201": { description: Created }

  /v1/articles/{articleId}:
    get:
      summary: Get article
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }
    patch:
      summary: Update article fields (status, taxonomy, intent/stage, etc.)
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/merge-patch+json:
            schema: { type: object }
      responses:
        "200": { description: OK }
    delete:
      summary: Archive (soft delete) or hard delete (admin)
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
        - name: mode
          in: query
          schema: { type: string, enum: [soft,hard], default: soft }
      responses:
        "204": { description: No Content }

  /v1/articles/{articleId}/locales:
    get:
      summary: List locales for an article
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }
    post:
      summary: Create/initialize a locale (empty or cloned from canonical structure)
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                locale: { type: string }
                mode: { type: string, enum: [empty,clone_structure], default: clone_structure }
              required: [locale]
      responses:
        "201": { description: Created }

  /v1/articles/{articleId}/locales/{locale}:
    get:
      summary: Get localized article content
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
        - name: locale
          in: path
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }
    put:
      summary: Replace localized content (blocks, seo, faq, etc.)
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
        - name: locale
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "SCHEMA.v1.json#/$defs/ArticleLocale" }
      responses:
        "200": { description: OK }
    patch:
      summary: Partial update localized content
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
        - name: locale
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/merge-patch+json:
            schema: { type: object }
      responses:
        "200": { description: OK }

  /v1/articles/{articleId}/generate:
    post:
      summary: IA - Generate outline/blocks/seo for a locale (constrained)
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                locale: { type: string }
                tasks:
                  type: array
                  items:
                    type: string
                    enum: [outline,blocks,faq,table,seo]
                sources: { type: array, items: { type: string } }
                word_target: { type: integer, minimum: 200, maximum: 5000 }
              required: [locale,tasks]
      responses:
        "200": { description: OK }

  /v1/articles/{articleId}/localize:
    post:
      summary: IA - Create/refresh a target locale from canonical locale (structure-preserving)
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                from_locale: { type: string }
                to_locale: { type: string }
                tasks:
                  type: array
                  items: { type: string, enum: [translate_blocks,seo,faq,anchors] }
              required: [from_locale,to_locale]
      responses:
        "200": { description: OK }

  /v1/articles/{articleId}/linkplan:
    post:
      summary: Compute InternalLinkPlan for a locale (rules + scoring)
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                locale: { type: string }
                ruleset_version: { type: string, default: v1 }
              required: [locale]
      responses:
        "200": { description: OK }

  /v1/articles/{articleId}/preview:
    post:
      summary: Build preview URLs (no publish)
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }

  /v1/articles/{articleId}/publish:
    post:
      summary: Publish article (atomic) + cache invalidation + sitemap updates
      parameters:
        - name: articleId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                locales: { type: array, items: { type: string } }
                scheduled_at: { type: string, format: date-time }
      responses:
        "200": { description: OK }

  /v1/media:
    post:
      summary: Upload/register media + variants
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "SCHEMA.v1.json#/$defs/Media" }
      responses:
        "201": { description: Created }

  /v1/redirects:
    get:
      summary: List redirects
      responses:
        "200": { description: OK }
    post:
      summary: Create redirect (slug changes)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "SCHEMA.v1.json#/$defs/Redirect" }
      responses:
        "201": { description: Created }

  /v1/taxonomy:
    get:
      summary: Get taxonomy (clusters/categories/tags/glossary)
      responses:
        "200": { description: OK }
    put:
      summary: Replace taxonomy (admin)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "SCHEMA.v1.json#/$defs/Taxonomy" }
      responses:
        "200": { description: OK }

  /v1/sitemaps/rebuild:
    post:
      summary: Rebuild sitemaps (admin/ops)
      responses:
        "200": { description: OK }


Implémentation recommandée côté routing (minimal) :

Public: /{locale}/blog/{slug} → resolve ArticleLocale by (locale, slug)

Admin: /admin/blog (CRUD + preview + publish)

Single source of truth: Article.id + ArticleLocale(article_id, locale)

Liens internes: stockés par to_article_id, résolus en slug à l’affichage (multilangue natif).